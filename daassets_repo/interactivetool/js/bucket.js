(function(e){e.fn.bucketTool=function(){var t=this,n=t.width(),r=t.height(),i=t.loadCanvas();t.unbind();t.on(getTouchEventName("mousedown"),function(s){hist.push(last.src=t[0].toDataURL("image/png"));var o=e("#stroke").css("backgroundColor"),o=o.substring(4,o.length-1).split(", "),u=parseFloat(o[0]),a=parseFloat(o[1]),f=parseFloat(o[2]),l=255,c=s.offsetX,h=s.offsetY,p=i.getImageData(0,0,n,r),d=i.getImageData(c,h,1,1),v=d.data[0],m=d.data[1],g=d.data[2],y=255,b=0;for(b=0;b<p.data.length;b++){var w=b*4,E=p.data;if(E[w]===v&&E[w+1]===m&&E[w+2]===g){p.data[w]=u;p.data[w+1]=a;p.data[w+2]=f;p.data[w+3]=l}}i.putImageData(p,0,0)})}})(jQuery);