!function($){$(document).ready(function(){function o(o){return void 0!==window.ontouchstart&&l[o]&&(o=l[o]),o}function a(){c.$canvas.clearCanvas(),c.$canvas.drawRect({fillStyle:"#fff",x:0,y:0,width:c.canvasW,height:c.canvasH,fromCenter:!1})}function s(){r.stroke.width(c.stroke),r.stroke.height(c.stroke),r.stroke.css({marginTop:(r.box.height()-r.stroke.height())/2}),c.start===!1?(r.stroke.css({backgroundColor:c.color}),c.start+=1):c.start===!0&&r.stroke.stop().animate({backgroundColor:c.color},i),c.start=!0}function e(){function o(o,a){d[o]&&d[o][a]&&$('<div class="color '+o+" "+a+'" />').css({backgroundColor:d[o][a]}).appendTo("#colors")}var a,s;for(s=0;s<u.length;s+=1)a=u[s],o(a,"light"),o(a,"medium"),o(a,"dark")}function n(o){var a=o.split(" ");o=$("."+a[0]+"."+a[1]),o.addClass("chosen"),c.color=o.css("backgroundColor"),s()}function t(o){var a=r.slider.width(),s=r.slider.children("#filler");s.width(a*(o/100))}var c={$canvas:$("#canvas"),color:"blue medium",press:!1,last:new Image,hist:[],undoHist:[],clicks:0,start:!1};c.canvasW=c.$canvas.width(),c.canvasH=c.$canvas.height();var r={stroke:$("#stroke"),strokeContainer:$("#stroke-container"),box:$("#box"),tools:$("#tools"),clear:$("#clear"),slider:$("#slider"),colors:$("#colors"),brush:$("#brush"),path:$("#path"),rect:$("#rect"),ellipse:$("#ellipse"),erase:$("#erase"),undo:$("#undo"),redo:$("#redo"),save:$("#save")},i,l={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"};c.getTouchEventName=o;var d={red:{dark:"#a11",medium:"#c33",light:"#e55"},green:{dark:"#4b1",medium:"#6d2",light:"#8f4"},blue:{dark:"#14b",medium:"#36d",light:"#58f"},orange:{dark:"#d51",medium:"#f73",light:"#f95"},yellow:{dark:"#ed2",medium:"#fe3",light:"#ff5"},purple:{dark:"#75d",medium:"#96f",light:"#b8f"},black:{dark:"#000",medium:"#666",light:"#ccc"}},u=["red","green","blue","orange","yellow","purple","brown","white","black"];r.tools.on("click",".tool",function(){r.tools.find(".chosen").removeClass("chosen"),$(this).addClass("chosen")}),r.clear.on("click",function(){c.$canvas.trigger("mouseup"),c.last.src=c.$canvas[0].toDataURL("image/png"),c.hist.push(c.last.src),a(),c.clicks=0}),r.save.on("click",function(){var o=c.$canvas[0].toDataURL("image/png");c.$canvas.mouseup(),window.open(o)}),r.undo.on("click",function(){if(c.$canvas.mouseup(),c.hist.length>0){c.clicks=0,c.undoHist.push(c.$canvas[0].toDataURL("image/png"));var o=c.hist.pop();c.$canvas.clearCanvas(),c.$canvas.drawImage({source:o,x:0,y:0,fromCenter:!1})}console.log("UNDO",c.hist.length,c.undoHist.length)}),r.redo.on("click",function(){if(c.$canvas.mouseup(),c.undoHist.length>0){c.clicks=0;var o=c.undoHist.pop();c.hist.push(c.$canvas[0].toDataURL("image/png")),c.$canvas.clearCanvas(),c.$canvas.drawImage({source:o,x:0,y:0,fromCenter:!1})}console.log("REDO",c.hist.length,c.undoHist.length)}),r.brush.on("click",function(){c.$canvas.brushTool(c),r.strokeContainer.slideDown(i)}),r.path.on("click",function(){c.last.src=c.$canvas[0].toDataURL("image/png"),c.$canvas.pathTool(c),r.strokeContainer.slideDown(i)}),r.rect.on("click",function(){c.last.src=c.$canvas[0].toDataURL("image/png"),c.$canvas.rectTool(c),r.strokeContainer.slideUp(i)}),r.ellipse.on("click",function(){c.last.src=c.$canvas[0].toDataURL("image/png"),c.$canvas.ellipseTool(c),r.strokeContainer.slideUp(i)}),r.erase.on("click",function(){c.last.src=c.$canvas[0].toDataURL("image/png"),c.$canvas.eraserTool(c),r.strokeContainer.slideDown(i)}),r.brush.click(),e(),n(c.color),r.colors.on("click",".color",function(){var o=$(this);$(".color.chosen").removeClass("chosen"),n(o.prop("class").replace(/(color|chosen) /gi,"")),o.addClass("chosen")}),r.slider.slider({min:1,value:50});var h=r.slider.slider("option","value");t(h),c.stroke=Math.round(h/2),s(),r.slider.bind("slide",function(o,a){var e=a.value;c.stroke=Math.round(e/2),s(),t(e)}),a()})}(jQuery,{});