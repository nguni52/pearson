!function($){$.fn.ellipseTool=function(e){function o(){t.drawEllipse({fillStyle:e.color,x:s,y:a,width:c,height:f})}function n(){t.drawArc({fillStyle:e.color,x:s,y:a,radius:Math.abs(c)/2,fromCenter:!0})}var t=this;t.unbind();var s,a,r,u,c,f;t.on(e.getTouchEventName("mousedown"),function(n){return e.hist.push(e.last.src=t[0].toDataURL("image/png")),e.undoHist.length=0,e.drag=!0,c=0,f=0,s=n.offsetX,a=n.offsetY,o(),!1}),t.on(e.getTouchEventName("mouseup"),function(){e.drag=!1,e.last.src=t[0].toDataURL("image/png")}),$(document).keydown(function(o){16===o.keyCode&&(e.press=!0)}),$(document).keyup(function(o){16===o.keyCode&&(e.press=!1)}),t.on(e.getTouchEventName("mousemove"),function(i){e.drag===!0&&t.clearCanvas().drawImage({source:e.last.src,x:0,y:0,fromCenter:!1,load:function(){r=i.offsetX+c/2,u=i.offsetY+f/2,c=r-s,f=u-a,e.press===!0?n():e.press===!1&&o()}})})}}(jQuery);